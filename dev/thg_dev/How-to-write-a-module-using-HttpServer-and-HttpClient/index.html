<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="darkcode0x00 luizcorrea">
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>How to write a module using HttpServer and HttpClient - thg-framework</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/darcula.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">thg-framework</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../cli/install/">Installation</a>
</li>
                                    
<li >
    <a href="../../..">Introduction</a>
</li>
                                    
<li >
    <a href="../../../community/">Community</a>
</li>
                                    
<li >
    <a href="../../../conceptual/">Conceptual</a>
</li>
                                    
<li >
    <a href="../../../cli/build/">build</a>
</li>
                                    
<li >
    <a href="../../../cli/tags/">tags</a>
</li>
                                    
<li >
    <a href="../../../LICENSE/">LICENSE</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">thg_dev <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">gettin_started</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../_Sidebar/">thg_Development_Environment</a>
</li>
            
<li >
    <a href="../Using-thg/">using_thg</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">git</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../git/Using-Git/">Using-Git</a>
</li>
            
<li >
    <a href="../../git/Git-cheatsheet/">Git_cheatsheet</a>
</li>
            
<li >
    <a href="../../git/Git-Reference-Sites/">Git-Reference-Sites</a>
</li>
    </ul>
  </li>
            
<li >
    <a href="../Reporting-a-Bug/">reporting_a_bug</a>
</li>
            
<li >
    <a href="../../contributing/Contributing-to-thg/">Get Started</a>
</li>
            
<li >
    <a href="../../../cli/templates/">templates</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Roadmaps</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">2019</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../roadmaps/2019/2019-Roadmap/">Roadmap</a>
</li>
            
<li >
    <a href="../../roadmaps/2019/2019-Roadmap-Review/">Roadmap_Review</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">contributing</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../Contributing-to-thg/">contributing_to_thg</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">thg_development</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">thg_how_to</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../How-to-get-started-with-writing-an-exploit/">How to get started with writing an exploit</a>
</li>
            
<li >
    <a href="../How-to-get-started-with-writing-an-auxiliary-module/">How to get started with writing an auxiliary module</a>
</li>
            
<li >
    <a href="../How-to-get-started-with-writing-a-post-module/">How to get started with writing a postmodule</a>
</li>
            
<li >
    <a href="../How-to-get-started-with-writing-a-Meterpreter-script/">How to get started with writing a script</a>
</li>
            
<li >
    <a href="../How-to-check-Microsoft-patch-levels-for-your-exploit/">How to check Microsoft patch levels for your exploit</a>
</li>
            
<li >
    <a href="../How-to-clean-up-files-using-XCybrerFileDropper/">How to clean up files using FileDropper</a>
</li>
            
<li >
    <a href="../How-to-deprecate-a-Metasploit-module/">How to deprecate a Metasploit module</a>
</li>
            
<li >
    <a href="../How-to-do-reporting-or-store-data-in-module-development/">How to do reporting or store data in module development</a>
</li>
            
<li >
    <a href="../How-to-log-in-Metasploit/">How to log in THG</a>
</li>
            
<li >
    <a href="../How-to-obfuscate-JavaScript-in-Metasploit/">How to obfuscate JavaScript in Metasploit</a>
</li>
            
<li >
    <a href="../How-to-parse-an-HTTP-response/">How to parse an HTTP response</a>
</li>
            
<li >
    <a href="../How-to-Send-an-HTTP-Request-Using-HTTPClient/">How to Send an HTTP Request Using HTTPClient</a>
</li>
            
<li >
    <a href="../How-to-send-an-HTTP-request-using-Rex-Proto-Http-Client/">How to send an HTTP request using Rex Proto Http Client</a>
</li>
            
<li >
    <a href="../How-to-use-command-stagers/">How to use command stagers</a>
</li>
            
<li >
    <a href="../How-to-use-datastore-options/">How to use datastore options</a>
</li>
            
<li >
    <a href="../How-to-use-Msf-Auxiliary-AuthBrute-to-write-a-bruteforcer/">How to use Msf Auxiliary AuthBrute to write a bruteforcer</a>
</li>
            
<li >
    <a href="../How-to-use-PhpEXE-to-exploit-an-arbitrary-file-upload-bug/">How to use PhpEXE to exploit an arbitrary file upload bug</a>
</li>
            
<li >
    <a href="../How-to-use-Powershell-in-an-exploit/">How to use Powershell in an exploit</a>
</li>
            
<li >
    <a href="../How-to-use-Railgun-for-Windows-post-exploitation/">How to use Railgun for Windows post exploitation</a>
</li>
            
<li >
    <a href="../How-to-Use-the-FILEFORMAT-mixin-to-create-a-file-format-exploit/">How to Use the FILEFORMAT mixin to create a file format exploit</a>
</li>
            
<li >
    <a href="../How-to-use-the-Msf-Exploit-Remote-Tcp-mixin/">How to use the Msf Exploit Remote Tcp mixin</a>
</li>
            
<li >
    <a href="../How-to-use-the-Seh-mixin-to-exploit-an-exception-handler/">How to use the Seh mixin to exploit an exception handler</a>
</li>
            
<li >
    <a href="../How-to-use-WbemExec-for-a-write-privilege-attack-on-Windows/">How to use WbemExec for a write privilege attack on Windows</a>
</li>
            
<li >
    <a href="../How-to-write-a-browser-exploit-using-BrowserExploitServer/">How to write a browser exploit using BrowserExploitServer</a>
</li>
            
<li >
    <a href="../How-to-write-a-browser-exploit-using-HttpServer/">How to write a browser exploit using HttpServer</a>
</li>
            
<li >
    <a href="../How-to-write-a-check()-method/">How to write a check() method</a>
</li>
            
<li >
    <a href="../How-to-write-a-HTTP-LoginScanner-Module/">How to write a HTTP LoginScanner Module</a>
</li>
            
<li class="active">
    <a href="./">How to write a module using HttpServer and HttpClient</a>
</li>
            
<li >
    <a href="../How-to-zip-files-with-Rex-Zip-Archive.md">How to zip files with Rex Zip Archive</a>
</li>
            
<li >
    <a href="../How-to-use-Metasploit-Framework-Obfuscation-CRandomizer/">How to use Metasploit Framework Compiler Windows to compile C code</a>
</li>
            
<li >
    <a href="../How to use Metasploit Framework Obfuscation CRandomizer">How to use Metasploit Framework Obfuscation CRandomizer</a>
</li>
            
<li >
    <a href="../How-to-decrypt-RC4-with-Metasploit-Framework-Compiler/">How to decrypt RC4 with Metasploit Framework Compiler</a>
</li>
            
<li >
    <a href="../How-to-decode-Base64-with-thg-Framework-Compiler.md">How to decode Base64 with tgh Framework Compiler</a>
</li>
            
<li >
    <a href="../How-to-XOR-with-thg-Framework-Compiler.md">How to XOR with thg Framework Compiler</a>
</li>
    </ul>
  </li>
            
<li >
    <a href="../Style_Tips/">Style_Tips</a>
</li>
            
<li >
    <a href="../Running-Private-Modules/">Running Private Modules</a>
</li>
            
<li >
    <a href="../Exploit-Ranking/">Exploit Ranking</a>
</li>
            
<li >
    <a href="../THG-module-reference-identifiers/">THG module reference identifiers</a>
</li>
            
<li >
    <a href="../Using-ReflectiveDll-Injection.md">Using ReflectiveDll Injection</a>
</li>
            
<li >
    <a href="../Oracle-Usage.md">Oracle Usage</a>
</li>
            
<li >
    <a href="../Rex-Layout.md">Rex Layout</a>
</li>
            
<li >
    <a href="../">Definition of Module Reliability, Side Effects, and Stability</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">documentation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">capture the flag</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">basic</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">analysis</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/analysis/linux/">linux</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/analysis/windows/">windows</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/analysis/malware/">malware</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">recovery</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/recover/backuo/">backup</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/recover/patching/">patching</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">tips_end_tricks</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/tips_end_tricks/tools/">tools</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/tips_end_tricks/decoding/">decoding</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/tips_end_tricks/dos/">dos</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/tips_end_tricks/os_cheats/">os_cheats</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/tips_end_tricks/snort/">snort</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">identify</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/identify/basic/">basic</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/identify/nmap/">nmap</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/identify/nessus/">nessus</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/identify/openvas/">openvas</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/identify/windows/">windows</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/identify/linux/">linux</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">defend</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/prootect_defend/windows/">windows</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/prootect_defend/linux/">linux</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">identify</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/detect/tcpdump/">tcpdump</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/detect/editcap/">edicap</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/detect/mergecap/">mergecap</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/detect/snort/">snort</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/detect/tshark/">tshark</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/detect/analysis/">analysis</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">os</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/detect/linux/">linux</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/detect/windows/">windows</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
<li >
    <a href="../../../deployment/">Deployment</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">hash_crack</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/hash_crack/">index</a>
</li>
            
<li >
    <a href="../../../capturetheflag/hash_crack/CORE_HASH_CRACKING_KNOWLEDGE/">CORE_HASH_CRACKING_KNOWLEDGE</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">pentest_standard</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../pentest_standard/preengagemente/">Pre engagement Interactions</a>
</li>
            
<li >
    <a href="../../../pentest_standard/ig/">Intelligence Gathering</a>
</li>
            
<li >
    <a href="../../../pentest_standard/threatmodeling/">Threat Modeling</a>
</li>
            
<li >
    <a href="../../../pentest_standard/vulnterability/">Vulnerability Analysis</a>
</li>
            
<li >
    <a href="../../../pentest_standard/exploration/">Exploitation</a>
</li>
            
<li >
    <a href="../../../pentest_standard/postexploration/">Post Exploitation</a>
</li>
            
<li >
    <a href="../../../pentest_standard/report/">Reporting</a>
</li>
            
<li >
    <a href="../../../pentest_standard/tecguidelines/">Technical Guidelines</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">CLI <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">THG-PART-1</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../tutorials/thg/">THG</a>
</li>
            
<li >
    <a href="../../../tutorials/server/server/">thg_server</a>
</li>
            
<li >
    <a href="../../../tutorials/version/version/">thg_version</a>
</li>
            
<li >
    <a href="../../../tutorials/shells/shells/">thg_shells</a>
</li>
            
<li >
    <a href="../../../tutorials/thg_docs/thg_docs/">thg_docs</a>
</li>
            
<li >
    <a href="../../../tutorials/auxiliares/auxiliares/">thg_auxiliares</a>
</li>
            
<li >
    <a href="../../../tutorials/anti_forensic/anti_forensic/">thg_anti_forensic</a>
</li>
            
<li >
    <a href="../../../tutorials/crypto/crypto/">thg_crypto</a>
</li>
            
<li >
    <a href="../../../tutorials/drone/drone/">thg_drone</a>
</li>
            
<li >
    <a href="../../../tutorials/keylogger/keylogger/">thg_keylogger</a>
</li>
            
<li >
    <a href="../../../tutorials/recon/recon/">thg_recon</a>
</li>
            
<li >
    <a href="../../../tutorials/voip/voip/">thg_voip</a>
</li>
            
<li >
    <a href="../../../tutorials/automation/automation/">thg_automation</a>
</li>
            
<li >
    <a href="../../../tutorials/cryptography/cryptography/">thg_cryptography</a>
</li>
            
<li >
    <a href="../../../tutorials/exploitation/exploitation/">thg_exploitation</a>
</li>
            
<li >
    <a href="../../../tutorials/malware/malware/">thg_malware</a>
</li>
            
<li >
    <a href="../../../tutorials/reversing/reversing/">thg_reversing</a>
</li>
            
<li >
    <a href="../../../tutorials/thg_windows/thg_windows/">thg_windows</a>
</li>
            
<li >
    <a href="../../../tutorials/automobile/automobile/">thg_automobile</a>
</li>
            
<li >
    <a href="../../../tutorials/database/database/">thg_database</a>
</li>
            
<li >
    <a href="../../../tutorials/fingerprint/fingerprint/">thg_fingerprint</a>
</li>
            
<li >
    <a href="../../../tutorials/misc/misc/">thg_misc</a>
</li>
            
<li >
    <a href="../../../tutorials/sniffer/sniffer/">thg_sniffer</a>
</li>
            
<li >
    <a href="../../../tutorials/wireless/wireless/">thg_wireless</a>
</li>
            
<li >
    <a href="../../../tutorials/debugger/debugger/">thg_debugger</a>
</li>
            
<li >
    <a href="../../../tutorials/firmware/firmware/">thg_firmware</a>
</li>
            
<li >
    <a href="../../../tutorials/mobile/mobile/">thg_mobile</a>
</li>
            
<li >
    <a href="../../../tutorials/social/social/">thg_social</a>
</li>
            
<li >
    <a href="../../../tutorials/backdoor/backdoor/">thg_backdoor</a>
</li>
            
<li >
    <a href="../../../tutorials/decompiler/decompiler/">thg_decompiler</a>
</li>
            
<li >
    <a href="../../../tutorials/forensic/forensic/">thg_forensic</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">THG-PART-2</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../tutorials/networking/networking/">thg_networking</a>
</li>
            
<li >
    <a href="../../../tutorials/spoff/spoff/">thg_spoff</a>
</li>
            
<li >
    <a href="../../../tutorials/binary/binary/">thg_binary</a>
</li>
            
<li >
    <a href="../../../tutorials/defensensive/defensensive/">thg_defensensive</a>
</li>
            
<li >
    <a href="../../../tutorials/gpu/gpu/">thg_gpu</a>
</li>
            
<li >
    <a href="../../../tutorials/os/os/">thg_os</a>
</li>
            
<li >
    <a href="../../../tutorials/nfc/nfc/">thg_nfc</a>
</li>
            
<li >
    <a href="../../../tutorials/spoof/spoof/">thg_spoof</a>
</li>
            
<li >
    <a href="../../../tutorials/version/version/">thg_version</a>
</li>
            
<li >
    <a href="../../../tutorials/bluetooth/bluetooth/">thg_bluetooth</a>
</li>
            
<li >
    <a href="../../../tutorials/defensive/defensive/">thg_defensive</a>
</li>
            
<li >
    <a href="../../../tutorials/hardware/hardware/">thg_hardware</a>
</li>
            
<li >
    <a href="../../../tutorials/packer/packer/">thg_packer</a>
</li>
            
<li >
    <a href="../../../tutorials/stego/stego/">thg_stego</a>
</li>
            
<li >
    <a href="../../../tutorials/code_audit/code_audit/">thg_code_audit</a>
</li>
            
<li >
    <a href="../../../tutorials/disassembler/disassembler/">thg_disassembler</a>
</li>
            
<li >
    <a href="../../../tutorials/honeypot/honeypot/">thg_honeypot</a>
</li>
            
<li >
    <a href="../../../tutorials/proxy/proxy/">thg_proxy</a>
</li>
            
<li >
    <a href="../../../tutorials/tunnel/tunnel/">thg_tunnel</a>
</li>
            
<li >
    <a href="../../../tutorials/cracker/cracker/">thg_cracker</a>
</li>
            
<li >
    <a href="../../../tutorials/dos/dos/">thg_dos</a>
</li>
            
<li >
    <a href="../../../tutorials/ids/ids/">thg_ids</a>
</li>
            
<li >
    <a href="../../../tutorials/radio/radio/">thg_radio</a>
</li>
            
<li >
    <a href="../../../tutorials/unpacker/unpacker/">thg_unpacker</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../How-to-write-a-HTTP-LoginScanner-Module/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../How-to-use-Metasploit-Framework-Obfuscation-CRandomizer/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/darkcode357/thg-framework/edit/master/docs/dev/thg_dev/How-to-write-a-module-using-HttpServer-and-HttpClient.md">Edit on darkcode357/thg-framework</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#todays-lesson-send-a-http-request-to-attack-the-target-machine-and-use-a-httpserver-for-payload-delivery">Today's lesson: Send a HTTP request to attack the target machine, and use a HttpServer for payload delivery.</a></li>
        <li class="main "><a href="#related-articles">Related Articles:</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>Using multiple networking mixins in a Metasploit module is always a tricky thing to do, because most likely you will run into issues like overlapping datastore options, variables, methods, the super call is only meant for one mixin, etc. This is considered as advanced module development, and sometimes can be rather painful to figure out on your own. To improve the Metasploit development experience, we have a few examples to demonstrate common scenarios that require you to use multiple mixins to achieve exploitation. </p>
<h3 id="todays-lesson-send-a-http-request-to-attack-the-target-machine-and-use-a-httpserver-for-payload-delivery">Today's lesson: Send a HTTP request to attack the target machine, and use a HttpServer for payload delivery.</h3>
<p>Say you want to exploit a web server or web application. You have code execution on the box, but you need to find a way to deliver the final payload (probably an executable), and a HTTP server happens to be your option.</p>
<p>Here is how you can set it up:</p>
<div class="highlight"><pre><span></span><span class="c1">##</span>
<span class="c1"># This module requires Metasploit: http://metasploit.com/download</span>
<span class="c1"># Current source: https://github.com/rapid7/metasploit-framework</span>
<span class="c1">##</span>

<span class="nb">require</span> <span class="s1">&#39;msf/core&#39;</span>

<span class="k">class</span> <span class="nc">MetasploitModule</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Exploit</span><span class="o">::</span><span class="no">Remote</span>
  <span class="no">Rank</span> <span class="o">=</span> <span class="no">NormalRanking</span>

  <span class="kp">include</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Exploit</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">HttpClient</span>
  <span class="kp">include</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Exploit</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">HttpServer</span><span class="o">::</span><span class="no">HTML</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="p">{})</span>
    <span class="k">super</span><span class="p">(</span><span class="n">update_info</span><span class="p">(</span><span class="n">info</span><span class="p">,</span>
      <span class="s1">&#39;Name&#39;</span>           <span class="o">=&gt;</span> <span class="s2">&quot;HttpClient and HttpServer Example&quot;</span><span class="p">,</span>
      <span class="s1">&#39;Description&#39;</span>    <span class="o">=&gt;</span> <span class="sx">%q{</span>
<span class="sx">        This demonstrates how to use two mixins (HttpClient and HttpServer) at the same time,</span>
<span class="sx">        but this allows the HttpServer to terminate after a delay.</span>
<span class="sx">      }</span><span class="p">,</span>
      <span class="s1">&#39;License&#39;</span>        <span class="o">=&gt;</span> <span class="no">MSF_LICENSE</span><span class="p">,</span>
      <span class="s1">&#39;Author&#39;</span>         <span class="o">=&gt;</span> <span class="o">[</span> <span class="s1">&#39;sinn3r&#39;</span> <span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;References&#39;</span>     <span class="o">=&gt;</span>
        <span class="o">[</span>
          <span class="o">[</span><span class="s1">&#39;URL&#39;</span><span class="p">,</span> <span class="s1">&#39;http://metasploit.com&#39;</span><span class="o">]</span>
        <span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;Payload&#39;</span>        <span class="o">=&gt;</span> <span class="p">{</span> <span class="s1">&#39;BadChars&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="p">},</span>
      <span class="s1">&#39;Platform&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;win&#39;</span><span class="p">,</span>
      <span class="s1">&#39;Targets&#39;</span>        <span class="o">=&gt;</span>
        <span class="o">[</span>
          <span class="o">[</span> <span class="s1">&#39;Automatic&#39;</span><span class="p">,</span> <span class="p">{}</span> <span class="o">]</span><span class="p">,</span>
        <span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;Privileged&#39;</span>     <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span>
      <span class="s1">&#39;DisclosureDate&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Dec 09 2013&quot;</span><span class="p">,</span>
      <span class="s1">&#39;DefaultTarget&#39;</span>  <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">))</span>

      <span class="n">register_options</span><span class="p">(</span>
        <span class="o">[</span>
          <span class="no">OptString</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;TARGETURI&#39;</span><span class="p">,</span> <span class="o">[</span><span class="kp">true</span><span class="p">,</span> <span class="s1">&#39;The path to some web application&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="o">]</span><span class="p">),</span>
          <span class="no">OptInt</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;HTTPDELAY&#39;</span><span class="p">,</span>    <span class="o">[</span><span class="kp">false</span><span class="p">,</span> <span class="s1">&#39;Number of seconds the web server will wait before termination&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="o">]</span><span class="p">)</span>
        <span class="o">]</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">on_request_uri</span><span class="p">(</span><span class="n">cli</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>
    <span class="n">print_status</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">peer</span><span class="si">}</span><span class="s2"> - Payload request received: </span><span class="si">#{</span><span class="n">req</span><span class="o">.</span><span class="n">uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">send_response</span><span class="p">(</span><span class="n">cli</span><span class="p">,</span> <span class="s1">&#39;You get this, I own you&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">primer</span>
    <span class="n">print_status</span><span class="p">(</span><span class="s2">&quot;Sending a malicious request to </span><span class="si">#{</span><span class="n">target_uri</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">send_request_cgi</span><span class="p">({</span><span class="s1">&#39;uri&#39;</span><span class="o">=&gt;</span><span class="n">normalize_uri</span><span class="p">(</span><span class="n">target_uri</span><span class="o">.</span><span class="n">path</span><span class="p">)})</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">exploit</span>
    <span class="k">begin</span>
      <span class="no">Timeout</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">datastore</span><span class="o">[</span><span class="s1">&#39;HTTPDELAY&#39;</span><span class="o">]</span><span class="p">)</span> <span class="p">{</span> <span class="k">super</span> <span class="p">}</span>
    <span class="k">rescue</span> <span class="no">Timeout</span><span class="o">::</span><span class="no">Error</span>
      <span class="c1"># When the server stops due to our timeout, this is raised</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Here's what happens when you run the above example:</p>
<ol>
<li>The super call wrapped in the Timeout block will start the web server.</li>
<li>Before the web server is in the infinite loop state, the primer() method is called, which is where you send your malicious requests to get code execution.</li>
<li>Your HttpServer serves the final payload upon request.</li>
<li>After 10 seconds, the module raises a Timeout exception. The web server finally terminates.</li>
</ol>
<p>In case you're wondering why the web server must terminate after a period of time, this is because if the module fails to gain code execution on the target machine, obviously it will never ask your web server for the malicious payload, therefore there is no point to keeping it alive forever. Typically it shouldn't take a very long time to get a payload request, either, so we keep the timeout short.</p>
<p>The output for the above example should look something like this:</p>
<div class="highlight"><pre><span></span>msf exploit(test) &gt; run
[*] Exploit running as background job.

[*] Started reverse handler on 10.0.1.76:4444 
[*] Using URL: http://0.0.0.0:8080/SUuv1qjZbCibL80
[*]  Local IP: http://10.0.1.76:8080/SUuv1qjZbCibL80
[*] Server started.
[*] Sending a malicious request to /
msf exploit(test) &gt;
[*] 10.0.1.76        test - 10.0.1.76:8181 - Payload request received: /SUuv1qjZbCibL80
[*] Server stopped.

msf exploit(test) &gt;
</pre></div>

<h3 id="related-articles">Related Articles:</h3>
<ul>
<li><a href="https://github.com/rapid7/metasploit-framework/wiki/How-to-Send-an-HTTP-Request-Using-HTTPClient">https://github.com/rapid7/metasploit-framework/wiki/How-to-Send-an-HTTP-Request-Using-HTTPClient</a></li>
<li><a href="https://github.com/rapid7/metasploit-framework/wiki/How-to-write-a-browser-exploit-using-HttpServer">https://github.com/rapid7/metasploit-framework/wiki/How-to-write-a-browser-exploit-using-HttpServer</a></li>
<li><a href="https://community.rapid7.com/community/metasploit/blog/2012/12/17/metasploit-hooks">https://community.rapid7.com/community/metasploit/blog/2012/12/17/metasploit-hooks</a></li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2019 - 2020 darkcode0x00</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
