<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="darkcode0x00 luizcorrea">
        <link rel="canonical" href="https://darkcode357.github.io/thg-framework/dev/dark/Debugging-Dead-Meterpreter-Sessions/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Debugging Dead Meterpreter Sessions - thg-framework</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/darcula.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">thg-framework</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../cli/install/">Installation</a>
</li>
                                    
<li >
    <a href="../../..">Introduction</a>
</li>
                                    
<li >
    <a href="../../../community/">Community</a>
</li>
                                    
<li >
    <a href="../../../conceptual/">Conceptual</a>
</li>
                                    
<li >
    <a href="../../../cli/build/">build</a>
</li>
                                    
<li >
    <a href="../../../cli/tags/">tags</a>
</li>
                                    
<li >
    <a href="../../../LICENSE/">LICENSE</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">thg_dev <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../thg_dev/_Sidebar/">thg_dev</a>
</li>
                                    
<li >
    <a href="../../contributing/Contributing-to-thg/">Get Started</a>
</li>
                                    
<li >
    <a href="../../../cli/templates/">templates</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Roadmaps</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">2019</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../roadmaps/2019/2019-Roadmap/">Roadmap</a>
</li>
            
<li >
    <a href="../../roadmaps/2019/2019-Roadmap-Review/">Roadmap_Review</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">git</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../git/Using-Git/">Using-Git</a>
</li>
            
<li >
    <a href="../../git/Git-cheatsheet/">Git_cheatsheet</a>
</li>
            
<li >
    <a href="../../git/Git-Reference-Sites/">Git-Reference-Sites</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">documentation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">capture the flag</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">basic</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">analysis</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/analysis/linux/">linux</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/analysis/windows/">windows</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/analysis/malware/">malware</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">recovery</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/recover/backuo/">backup</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/recover/patching/">patching</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">tips_end_tricks</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/tips_end_tricks/tools/">tools</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/tips_end_tricks/decoding/">decoding</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/tips_end_tricks/dos/">dos</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/tips_end_tricks/os_cheats/">os_cheats</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/tips_end_tricks/snort/">snort</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">identify</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/identify/basic/">basic</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/identify/nmap/">nmap</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/identify/nessus/">nessus</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/identify/openvas/">openvas</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/identify/windows/">windows</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/identify/linux/">linux</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">defend</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/prootect_defend/windows/">windows</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/prootect_defend/linux/">linux</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">identify</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/detect/tcpdump/">tcpdump</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/detect/editcap/">edicap</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/detect/mergecap/">mergecap</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/detect/snort/">snort</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/detect/tshark/">tshark</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/detect/analysis/">analysis</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">os</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/basic/detect/linux/">linux</a>
</li>
            
<li >
    <a href="../../../capturetheflag/basic/detect/windows/">windows</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
<li >
    <a href="../../../deployment/">Deployment</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">hash_crack</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../capturetheflag/hash_crack/">index</a>
</li>
            
<li >
    <a href="../../../capturetheflag/hash_crack/CORE_HASH_CRACKING_KNOWLEDGE/">CORE_HASH_CRACKING_KNOWLEDGE</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">pentest_standard</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../pentest_standard/preengagemente/">Pre engagement Interactions</a>
</li>
            
<li >
    <a href="../../../pentest_standard/ig/">Intelligence Gathering</a>
</li>
            
<li >
    <a href="../../../pentest_standard/threatmodeling/">Threat Modeling</a>
</li>
            
<li >
    <a href="../../../pentest_standard/vulnterability/">Vulnerability Analysis</a>
</li>
            
<li >
    <a href="../../../pentest_standard/exploration/">Exploitation</a>
</li>
            
<li >
    <a href="../../../pentest_standard/postexploration/">Post Exploitation</a>
</li>
            
<li >
    <a href="../../../pentest_standard/report/">Reporting</a>
</li>
            
<li >
    <a href="../../../pentest_standard/tecguidelines/">Technical Guidelines</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">CLI <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">THG-PART-1</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../tutorials/thg/">THG</a>
</li>
            
<li >
    <a href="../../../tutorials/server/server/">thg_server</a>
</li>
            
<li >
    <a href="../../../tutorials/version/version/">thg_version</a>
</li>
            
<li >
    <a href="../../../tutorials/shells/shells/">thg_shells</a>
</li>
            
<li >
    <a href="../../../tutorials/thg_docs/thg_docs/">thg_docs</a>
</li>
            
<li >
    <a href="../../../tutorials/auxiliares/auxiliares/">thg_auxiliares</a>
</li>
            
<li >
    <a href="../../../tutorials/anti_forensic/anti_forensic/">thg_anti_forensic</a>
</li>
            
<li >
    <a href="../../../tutorials/crypto/crypto/">thg_crypto</a>
</li>
            
<li >
    <a href="../../../tutorials/drone/drone/">thg_drone</a>
</li>
            
<li >
    <a href="../../../tutorials/keylogger/keylogger/">thg_keylogger</a>
</li>
            
<li >
    <a href="../../../tutorials/recon/recon/">thg_recon</a>
</li>
            
<li >
    <a href="../../../tutorials/voip/voip/">thg_voip</a>
</li>
            
<li >
    <a href="../../../tutorials/automation/automation/">thg_automation</a>
</li>
            
<li >
    <a href="../../../tutorials/cryptography/cryptography/">thg_cryptography</a>
</li>
            
<li >
    <a href="../../../tutorials/exploitation/exploitation/">thg_exploitation</a>
</li>
            
<li >
    <a href="../../../tutorials/malware/malware/">thg_malware</a>
</li>
            
<li >
    <a href="../../../tutorials/reversing/reversing/">thg_reversing</a>
</li>
            
<li >
    <a href="../../../tutorials/thg_windows/thg_windows/">thg_windows</a>
</li>
            
<li >
    <a href="../../../tutorials/automobile/automobile/">thg_automobile</a>
</li>
            
<li >
    <a href="../../../tutorials/database/database/">thg_database</a>
</li>
            
<li >
    <a href="../../../tutorials/fingerprint/fingerprint/">thg_fingerprint</a>
</li>
            
<li >
    <a href="../../../tutorials/misc/misc/">thg_misc</a>
</li>
            
<li >
    <a href="../../../tutorials/sniffer/sniffer/">thg_sniffer</a>
</li>
            
<li >
    <a href="../../../tutorials/wireless/wireless/">thg_wireless</a>
</li>
            
<li >
    <a href="../../../tutorials/debugger/debugger/">thg_debugger</a>
</li>
            
<li >
    <a href="../../../tutorials/firmware/firmware/">thg_firmware</a>
</li>
            
<li >
    <a href="../../../tutorials/mobile/mobile/">thg_mobile</a>
</li>
            
<li >
    <a href="../../../tutorials/social/social/">thg_social</a>
</li>
            
<li >
    <a href="../../../tutorials/backdoor/backdoor/">thg_backdoor</a>
</li>
            
<li >
    <a href="../../../tutorials/decompiler/decompiler/">thg_decompiler</a>
</li>
            
<li >
    <a href="../../../tutorials/forensic/forensic/">thg_forensic</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">THG-PART-2</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../tutorials/networking/networking/">thg_networking</a>
</li>
            
<li >
    <a href="../../../tutorials/spoff/spoff/">thg_spoff</a>
</li>
            
<li >
    <a href="../../../tutorials/binary/binary/">thg_binary</a>
</li>
            
<li >
    <a href="../../../tutorials/defensensive/defensensive/">thg_defensensive</a>
</li>
            
<li >
    <a href="../../../tutorials/gpu/gpu/">thg_gpu</a>
</li>
            
<li >
    <a href="../../../tutorials/os/os/">thg_os</a>
</li>
            
<li >
    <a href="../../../tutorials/nfc/nfc/">thg_nfc</a>
</li>
            
<li >
    <a href="../../../tutorials/spoof/spoof/">thg_spoof</a>
</li>
            
<li >
    <a href="../../../tutorials/version/version/">thg_version</a>
</li>
            
<li >
    <a href="../../../tutorials/bluetooth/bluetooth/">thg_bluetooth</a>
</li>
            
<li >
    <a href="../../../tutorials/defensive/defensive/">thg_defensive</a>
</li>
            
<li >
    <a href="../../../tutorials/hardware/hardware/">thg_hardware</a>
</li>
            
<li >
    <a href="../../../tutorials/packer/packer/">thg_packer</a>
</li>
            
<li >
    <a href="../../../tutorials/stego/stego/">thg_stego</a>
</li>
            
<li >
    <a href="../../../tutorials/code_audit/code_audit/">thg_code_audit</a>
</li>
            
<li >
    <a href="../../../tutorials/disassembler/disassembler/">thg_disassembler</a>
</li>
            
<li >
    <a href="../../../tutorials/honeypot/honeypot/">thg_honeypot</a>
</li>
            
<li >
    <a href="../../../tutorials/proxy/proxy/">thg_proxy</a>
</li>
            
<li >
    <a href="../../../tutorials/tunnel/tunnel/">thg_tunnel</a>
</li>
            
<li >
    <a href="../../../tutorials/cracker/cracker/">thg_cracker</a>
</li>
            
<li >
    <a href="../../../tutorials/dos/dos/">thg_dos</a>
</li>
            
<li >
    <a href="../../../tutorials/ids/ids/">thg_ids</a>
</li>
            
<li >
    <a href="../../../tutorials/radio/radio/">thg_radio</a>
</li>
            
<li >
    <a href="../../../tutorials/unpacker/unpacker/">thg_unpacker</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li>
                                <a href="https://github.com/darkcode357/thg-framework/edit/master/docs/dev/dark/Debugging-Dead-Meterpreter-Sessions.md">Edit on darkcode357/thg-framework</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#background-knowledge">Background Knowledge</a></li>
            <li><a href="#requisite-reading">Requisite Reading</a></li>
            <li><a href="#stagers-stages-and-handlers">Stagers, Stages, and Handlers</a></li>
            <li><a href="#lhost-and-lport">LHOST and LPORT</a></li>
        <li class="main "><a href="#dead-shells-what-to-check-for">Dead Shells - What to check for?</a></li>
            <li><a href="#quick-things-to-check">Quick things to check</a></li>
            <li><a href="#not-so-quick-things-to-check">Not so quick things to check</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>Dead shells. Nobody likes them. Yet, despite the advances made in the Metasploit stagers and Meterperter itself, we still see them regularly.</p>
<p>There are many reasons why shells refuse to connect, or die after they&rsquo;re established. The goal of this post is to help people understand <em>why</em>. Hopefully, by the end, the most common causes will be understood, and users can fix things themselves. If there are cases that are missed in this post, then please let us know and we&rsquo;ll add them.</p>
<p>Over time, this post should become a canonical resource for debugging sessions.</p>
<h2 id="background-knowledge">Background Knowledge<a class="headerlink" href="#background-knowledge" title="Permanent link">&para;</a></h2>
<h3 id="requisite-reading">Requisite Reading<a class="headerlink" href="#requisite-reading" title="Permanent link">&para;</a></h3>
<p>Prior to diving into the possible breakages and their causes, it&rsquo;s important to have some background knowledge of stagers, and how Meterpreter works. Please be sure to read the following articles prior to reading the rest of this post:</p>
<ul>
<li>[[Meterpreter Stageless Mode]] - Covers the exploitation process, and how Meterpreter sessions are established. This is important because understanding how the different components interact, and what, allows for easier debugging later.</li>
<li>[[Meterpreter Configuration]] - Covers how configuration works in Meterpreter. This is important because it highlights the separation of configuration in stagers and Meterpreter. This alone is the key to many breakages, especially in HTTP/S payloads.</li>
<li>[[The ins and outs of HTTP and HTTPS communications in Meterpreter and Metasploit Stagers]] - Covers the detail of HTTP/S based communications in the stagers and in Meterpreter itself.</li>
</ul>
<h3 id="stagers-stages-and-handlers">Stagers, Stages, and Handlers<a class="headerlink" href="#stagers-stages-and-handlers" title="Permanent link">&para;</a></h3>
<p>Each exploit and handler is made up of multiple things, and they&rsquo;re all independent:</p>
<ul>
<li>A <strong>Stager</strong>: This is the small bit of code that is first executed by the target. It contains it&rsquo;s own bundled implementation of a communications channel. It has the goal of establishing communication with Metasploit, downloading the <strong>stage</strong>, and invoking it. It has it&rsquo;s <em>own configuration</em>.</li>
<li>A <strong>Stage</strong>: This is the second payload that is executed by the target. It is sent to the target via the communications channel that was opened by the <strong>stage</strong>. Once downloaded, it is invoked and from there it takes over. It has it&rsquo;s <em>own configuration</em>.</li>
<li>A <strong>Handler</strong>: This is the code that runs on the attacker&rsquo;s machine. It is responsible for handling the attacker-side of the communications channel that is established by the <strong>stager</strong>. It is responsible for uploading the <strong>stage</strong>. It is responsible for handling communication between the attacker and the target once the stage has taken over from the stager.</li>
</ul>
<p>In some cases there might be multiple stages (as is the case with POSIX Meterpreter). This is called an <strong>intermediate</strong> stage. Usually these stages are slightly bigger than the stager and can do more work to help establish communications. In the context of this article, they aren&rsquo;t too important.</p>
<p>The most important thing to remember is that both the <strong>stager</strong> and the <strong>stage</strong> have their own configurations that are <strong>independent</strong>. <em>THE MOST COMMON</em> cause of dead shells is the result of the <strong>stage</strong> not having the correct configuration (ie. it&rsquo;s different to that specified in the <strong>stager</strong>).</p>
<h3 id="lhost-and-lport">LHOST and LPORT<a class="headerlink" href="#lhost-and-lport" title="Permanent link">&para;</a></h3>
<p>Any user of Metasploit will tell you that they know what <code>LHOST</code> and <code>LPORT</code> mean, yet it&rsquo;s incredibly common to find out that their understanding isn&rsquo;t 100% correct. To prevent dead sessions that are related to misconfiguration of these values, we need to make sure we understand what they mean.</p>
<h4 id="lhost">LHOST<a class="headerlink" href="#lhost" title="Permanent link">&para;</a></h4>
<p><code>LHOST</code> is short for <em>Local Host</em>. This value represents the IP address or host name that <strong>stagers</strong> and <strong>stages</strong> should attempt to connect to. It is where the <strong>handler</strong> can be reached. This doesn&rsquo;t mean that this is where the handler actually <em>exists</em>.</p>
<p><code>LHOST</code> is a value that meaning from the perspective of the target machine. This value is passed along as part of the configuration for <strong>stagers</strong> and <strong>stages</strong>, and tells the target machine where to go to reach the handler, and so this has to map to a value that <em>is reachable by the target</em>.</p>
<p>A <strong>handler</strong> obviously needs to listen on a host/IP for the incoming connection. In cases where the <code>LHOST</code> value (ie. the address that the target is able to reach) is the <em>same</em> as that which the host can listen on, no extra work has to be done. The <code>LHOST</code> value is used by the handler.</p>
<p>However, if some kind of NAT or port forward is enabled, or if the handler is behind a firewall, etc, then setting <code>LHOST</code> isn&rsquo;t enough. In order to listen on the appropriate interface, another setting must be used called <code>ReverseListenerBindHost</code>. This value tells the <strong>handler</strong> to listen on a different interface/IP, but it doesn&rsquo;t change the fact that the <code>LHOST</code> value is given to the target when the <strong>stage</strong> is uploaded.</p>
<p>In short, <code>LHOST</code> must always remain the IP/host that is routable from the target, and if this value is not the same as what the listener needs to bind to, then change the <code>ReverseListenerBindHost</code> value. If you&rsquo;re attacking something across the Internet and you specify an internal IP in <code>LHOST</code>, you&rsquo;re doing it wrong.</p>
<h4 id="lport">LPORT<a class="headerlink" href="#lport" title="Permanent link">&para;</a></h4>
<p>The principles of <code>LHOST</code> / <code>ReverseListenerBindHost</code> can be applied to <code>LPORT</code> and <code>ReverseListenerBindPort</code> as well. If you have port forwarding in place, and your listener needs to bind to a different port, then you need to make use of the <code>ReverseListenerBindPort</code> setting.</p>
<p>The classic example of this case is where an attacker wants to make use of port <code>443</code>, but rightfully doesn&rsquo;t want to run Metasploit as <code>root</code> just so they can directly bind to ports lower than <code>1024</code>. Instead, the set up a port forward (on their router, or using <code>iptables</code>) so that <code>443</code> forwards to <code>8443</code>, with a goal of accepting connections on that port instead.</p>
<p>To accommodate this scenario, the <code>LHOST</code> value must <strong>still contain <code>443</code></strong>, as this is the port that the target machine needs to establish communications on; <code>443</code> is the value that needs to go out with the <strong>stager</strong> and the <strong>stage</strong> configurations. Metasploit needs to bind locally to port <code>8443</code>, and so the <strong>handler</strong> is configured so that <code>ReverseListenerBindPort</code> has this value instead.</p>
<p>When the handler launches, it binds to <code>8443</code> and handles any connections it receives. When a stage is generated, it uses <code>443</code> from <code>LHOST</code> value to populate the configuration.</p>
<p>If the attacker makes the mistake of either setting <code>LPORT</code> to <code>8443</code>, or leaving <code>LPORT</code> as <code>443</code> and not using <code>ReverseListenerBindPort</code>, then the result is either a dead shell after the first stage, or no connect back at all.</p>
<h2 id="dead-shells-what-to-check-for">Dead Shells - What to check for?<a class="headerlink" href="#dead-shells-what-to-check-for" title="Permanent link">&para;</a></h2>
<h3 id="quick-things-to-check">Quick things to check<a class="headerlink" href="#quick-things-to-check" title="Permanent link">&para;</a></h3>
<ul>
<li>Make sure that <code>LHOST</code> is set to a routable address from the target, and not a local listen address.</li>
<li>Make sure that <code>LPORT</code> is set to the port number that the target needs to connect to.</li>
<li>Make sure that <code>ReverseListenerBindPort</code> is set if port forwarding is enabled and the traffic is being routed to a different port.</li>
<li>Make sure that your listener&rsquo;s configuration matches that of the target from an architecture perspective. If you mix x64 listeners with x86 payloads (and vice versa), things will go bad.</li>
</ul>
<h3 id="not-so-quick-things-to-check">Not so quick things to check<a class="headerlink" href="#not-so-quick-things-to-check" title="Permanent link">&para;</a></h3>
<ul>
<li>If the target is running AntiVirus there&rsquo;s a chance that the <strong>stage</strong> (ie. <code>metsrv</code>) is being caught while being uploaded. <code>reverse_tcp</code> and <code>reverse_http</code> <strong>stagers</strong> download <code>metsrv</code> <em>without</em> any encryption, and so the content of the DLL is visible to anything watching on the wire. <code>reverse_https</code> can still get caught in cases where AV is doing MITM content inspection. In this case, consider encoding your payloads, or if possible using <em>stageless</em> meterpreter instead. </li>
</ul>
<p>&hellip; more to come &hellip;</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2019 - 2020 darkcode0x00</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
